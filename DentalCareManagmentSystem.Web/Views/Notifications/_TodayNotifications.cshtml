@model List<DentalCareManagmentSystem.Application.DTOs.AppointmentDto>

@if (Model == null || !Model.Any())
{
    <div class="text-center text-muted py-4">
        <i class="fas fa-check-circle fa-3x mb-2 text-success"></i>
        <p class="fs-6">No notifications for today 🎉</p>
    </div>
}
else
{
    <div class="d-flex flex-column gap-3">
        @foreach (var appointment in Model)
        {
            <div class="card shadow-sm border-0 rounded-4 notification-card"
                 style="transition: all 0.4s ease;">
                <div class="card-body d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="fw-bold text-primary mb-1">
                            <i class="fas fa-user me-1 text-secondary"></i> @appointment.PatientName
                        </h6>
                        <small class="text-muted d-block mb-1">
                            <i class="far fa-calendar-alt me-1"></i>
                            @appointment.Date.ToString("yyyy-MM-dd")
                        </small>
                        <small class="text-muted d-block mb-1">
                            <i class="far fa-clock me-1"></i>
                            @appointment.StartTime.ToString(@"hh\:mm") → @appointment.EndTime.ToString(@"hh\:mm")
                        </small>
                        <small class="text-muted">
                            <i class="fas fa-phone me-1"></i> @appointment.PatientPhone
                        </small>
                    </div>

                    <button class="btn btn-outline-success btn-sm fw-bold mark-done-btn"
                            data-id="@appointment.Id">
                        <i class="fas fa-check me-1"></i> Done
                    </button>
                </div>
            </div>
        }
    </div>
}

@section Scripts {
    <script>
        $(document).ready(function () {
            $(".mark-done-btn").click(function () {
                const id = $(this).data("id");
                const card = $(this).closest(".notification-card");

                $.ajax({
                    url: '/Notifications/MarkDone',
                    type: 'POST',
                    data: { id: id },
                    success: function () {
                        card.addClass("animate__animated animate__fadeOutRight");
                        setTimeout(() => {
                            card.remove();

                            let count = $(".notification-card").length;
                            $("#notificationCount").text(count);

                            if (count <= 0) {
                                $("#notificationCount").hide();
                                $("#notificationList").html(`
                                    <div class="text-center text-muted py-4">
                                        <i class='fas fa-check-circle fa-3x mb-2 text-success'></i>
                                        <p class='fs-6'>No notifications for today </p>
                                    </div>
                                `);
                            }
                        }, 500);
                    },
                    error: function () {
                        alert("Failed to mark as done. Please try again.");
                    }
                });
            });
        });
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
}
